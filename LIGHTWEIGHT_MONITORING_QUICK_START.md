# è½»é‡çº§ç›‘æ§å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ ç«‹å³ä½¿ç”¨

### è‡ªåŠ¨æ¨¡å¼ï¼ˆæ¨èï¼‰

åˆ›å»ºå·¡æ£€ä»»åŠ¡æ—¶ï¼Œæ— éœ€ä»»ä½•é…ç½®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹ç½‘ç«™ç±»å‹ï¼ˆSPA/SSR/é™æ€ï¼‰
2. é€‰æ‹©åˆé€‚çš„ç›‘æ§çº§åˆ«
3. ä¼˜å…ˆä½¿ç”¨è½»é‡çº§æ£€æŸ¥

**ç¤ºä¾‹**ï¼š

```typescript
// å‰ç«¯ï¼šåˆ›å»ºå·¡æ£€ä»»åŠ¡
const task = {
  name: 'æ—¥å¸¸ç½‘ç«™ç›‘æ§',
  urls: [
    { url: 'https://www.anker.com', name: 'Anker é¦–é¡µ' },
    { url: 'https://blog.anker.com', name: 'åšå®¢' },
    { url: 'https://account.anker.com', name: 'ç”¨æˆ·ä¸­å¿ƒ' }
  ]
};

// ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
// - www.anker.com â†’ STANDARD (SSR ç½‘ç«™)
// - blog.anker.com â†’ LIGHTWEIGHT (é™æ€åšå®¢)
// - account.anker.com â†’ BROWSER (SPA åº”ç”¨)
```

---

## ğŸ“Š æŸ¥çœ‹æ•ˆæœ

### 1. æŸ¥çœ‹æ—¥å¿—

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
npm run dev

# è§¦å‘å·¡æ£€ä»»åŠ¡åï¼ŒæŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend | grep -E "(Lightweight|BROWSER|STANDARD)"
```

**é¢„æœŸæ—¥å¿—è¾“å‡º**ï¼š

```
[Desktop Test] Testing 10 URLs with max concurrency: 3
  âœ“ [Lightweight] Anker é¦–é¡µ passed quick check (234ms)
  âœ“ [Lightweight] åšå®¢ passed quick check (156ms)
  âš ï¸  [Lightweight] ç”¨æˆ·ä¸­å¿ƒ needs full browser test: Requires full browser test
  ğŸ¯ [Browser] Testing ç”¨æˆ·ä¸­å¿ƒ with Playwright...
```

### 2. å¯¹æ¯”æ€§èƒ½

**ä¼˜åŒ–å‰**ï¼ˆæ‰€æœ‰ç½‘ç«™ç”¨æµè§ˆå™¨ï¼‰ï¼š
```
å¼€å§‹å·¡æ£€: 10 ä¸ª URL
å®Œæˆæ—¶é—´: 52 ç§’
å†…å­˜å ç”¨: 1.2 GB
```

**ä¼˜åŒ–å**ï¼ˆæ™ºèƒ½ç›‘æ§ï¼‰ï¼š
```
å¼€å§‹å·¡æ£€: 10 ä¸ª URL
  - 8 ä¸ª â†’ è½»é‡çº§æ£€æŸ¥ï¼ˆ2 ç§’ï¼‰
  - 2 ä¸ª â†’ æµè§ˆå™¨æµ‹è¯•ï¼ˆ10 ç§’ï¼‰
å®Œæˆæ—¶é—´: 12 ç§’ âœ… æé€Ÿ 4.3x
å†…å­˜å ç”¨: 350 MB âœ… é™ä½ 71%
```

---

## ğŸ¯ æ‰‹åŠ¨æŒ‡å®šç›‘æ§çº§åˆ«

å¦‚æœè‡ªåŠ¨æ£€æµ‹ä¸å‡†ç¡®ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š

### å‰ç«¯ç•Œé¢ï¼ˆå¾…å®ç°ï¼‰

åœ¨åˆ›å»ºå·¡æ£€ä»»åŠ¡æ—¶ï¼Œä¸ºæ¯ä¸ª URL é€‰æ‹©ç›‘æ§çº§åˆ«ï¼š

```
URL: https://www.anker.com
åç§°: Anker é¦–é¡µ
ç›‘æ§çº§åˆ«: [è‡ªåŠ¨æ£€æµ‹ â–¼]
  - è‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰
  - è½»é‡çº§ï¼ˆHTTP æ£€æŸ¥ï¼‰
  - æ ‡å‡†ï¼ˆHTTP + SSL + DNSï¼‰
  - æµè§ˆå™¨ï¼ˆå®Œæ•´æµ‹è¯•ï¼‰
```

### API è°ƒç”¨

```typescript
POST /api/v1/patrol/tasks

{
  "name": "ç½‘ç«™ç›‘æ§ä»»åŠ¡",
  "urls": [
    {
      "url": "https://www.anker.com",
      "name": "é¦–é¡µ",
      "monitoringLevel": "lightweight"  // æ‰‹åŠ¨æŒ‡å®š
    },
    {
      "url": "https://account.anker.com",
      "name": "ç”¨æˆ·ä¸­å¿ƒ",
      "monitoringLevel": "browser"  // æ‰‹åŠ¨æŒ‡å®š
    }
  ]
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯• 1: å¥åº·ç½‘ç«™ï¼ˆè½»é‡çº§é€šè¿‡ï¼‰

```bash
# ä½¿ç”¨ curl æ¨¡æ‹Ÿè½»é‡çº§ç›‘æ§
curl -I https://www.anker.com

# é¢„æœŸå“åº”æ—¶é—´: < 500ms
# é¢„æœŸçŠ¶æ€: 200 OK
# ç³»ç»Ÿè¡Œä¸º: è·³è¿‡æµè§ˆå™¨æµ‹è¯• âœ…
```

### æµ‹è¯• 2: æ•…éšœç½‘ç«™ï¼ˆè½»é‡çº§å¤±è´¥ï¼‰

```bash
# æµ‹è¯•ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢
curl -I https://www.anker.com/non-existent-page

# é¢„æœŸå“åº”: 404 Not Found
# ç³»ç»Ÿè¡Œä¸º: å‡çº§åˆ°æµè§ˆå™¨æµ‹è¯•ï¼ŒåŒé‡ç¡®è®¤ âœ…
```

### æµ‹è¯• 3: SSL è¯ä¹¦æ£€æŸ¥

```bash
# æ ‡å‡†ç›‘æ§ä¼šæ£€æŸ¥ SSL è¯ä¹¦
# ç³»ç»Ÿè¡Œä¸º:
#   - è¯ä¹¦æœ‰æ•ˆ â†’ é€šè¿‡
#   - è¯ä¹¦ < 30 å¤©è¿‡æœŸ â†’ å‘Šè­¦
#   - è¯ä¹¦å·²è¿‡æœŸ â†’ å¤±è´¥
```

---

## ğŸ“ˆ ç›‘æ§ç»Ÿè®¡

### æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```typescript
// åœ¨ backend ä»£ç ä¸­
import { monitoringService } from './monitoring/index.js';

const stats = monitoringService.getCacheStats();
console.log(stats);

// è¾“å‡ºç¤ºä¾‹:
// {
//   size: 15,
//   levels: {
//     lightweight: 9,  // 60%
//     standard: 4,     // 27%
//     browser: 2,      // 13%
//     auto: 0
//   }
// }
```

### æ¸…ç©ºç¼“å­˜ï¼ˆé‡æ–°æ£€æµ‹ï¼‰

```typescript
// å¦‚æœç½‘ç«™æ›´æ–°ï¼ˆä» SSR æ”¹ä¸º SPAï¼‰ï¼Œéœ€è¦æ¸…ç©ºç¼“å­˜
monitoringService.clearDetectionCache();

// ä¸‹æ¬¡å·¡æ£€æ—¶ä¼šé‡æ–°æ£€æµ‹æ‰€æœ‰ç½‘ç«™ç±»å‹
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: æŸä¸ª SSR ç½‘ç«™è¢«è¯¯åˆ¤ä¸º SPAï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: æ‰‹åŠ¨æŒ‡å®šç›‘æ§çº§åˆ«

```typescript
{
  url: 'https://example.com',
  name: 'Example',
  monitoringLevel: 'standard'  // å¼ºåˆ¶ä½¿ç”¨æ ‡å‡†ç›‘æ§
}
```

### Q2: è½»é‡çº§ç›‘æ§é€šè¿‡ï¼Œä½†ç½‘ç«™å®é™…æœ‰é—®é¢˜ï¼Ÿ

**åŸå› **: è½»é‡çº§ç›‘æ§åªæ£€æŸ¥ HTTP çŠ¶æ€ï¼Œæ— æ³•æ£€æµ‹ï¼š
- JavaScript è¿è¡Œæ—¶é”™è¯¯
- å†…å®¹æ¸²æŸ“é—®é¢˜
- å¤æ‚äº¤äº’æµç¨‹

**è§£å†³æ–¹æ¡ˆ**:
- å¯¹å…³é”®é¡µé¢ä½¿ç”¨ `monitoringLevel: 'browser'`
- å¯ç”¨è§†è§‰å¯¹æ¯”åŠŸèƒ½

### Q3: æƒ³è¦æ›´é¢‘ç¹çš„å®Œæ•´æ£€æŸ¥ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: è°ƒæ•´ 24 å°æ—¶è‡ªåŠ¨æ£€æµ‹æœºåˆ¶

```typescript
// ä¿®æ”¹ MonitoringService.ts
private readonly CACHE_TTL = 1 * 60 * 60 * 1000; // æ”¹ä¸º 1 å°æ—¶
```

### Q4: å¦‚ä½•å…³é—­è½»é‡çº§ç›‘æ§ï¼Ÿ

**ä¸´æ—¶å…³é—­**: ä¸ºæ‰€æœ‰ URL æŒ‡å®š `monitoringLevel: 'browser'`

**å®Œå…¨å…³é—­**: æ³¨é‡Šæ‰ PatrolService.ts ä¸­çš„è½»é‡çº§ç›‘æ§ä»£ç 

```typescript
// åœ¨ PatrolService.ts ä¸­æ³¨é‡Šæ‰è¿™æ®µä»£ç 
// ğŸ¯ æ­¥éª¤ 1: å…ˆå°è¯•è½»é‡çº§ç›‘æ§ï¼ˆå¿«é€Ÿæ£€æŸ¥ï¼‰
// try {
//   const lightweightResult = await monitoringService.checkUrl(urlConfig);
//   ...
// } catch (error) {
//   ...
// }
```

---

## ğŸ”§ é«˜çº§é…ç½®

### 1. è°ƒæ•´æµè§ˆå™¨æ± å¤§å°

ç”±äºè½»é‡çº§ç›‘æ§å‡å°‘äº†æµè§ˆå™¨ä½¿ç”¨ï¼Œå¯ä»¥è°ƒæ•´æµè§ˆå™¨æ± é…ç½®ï¼š

```env
# .env
BROWSER_POOL_SIZE=2                    # ä» 5 é™ä¸º 2
MIN_BROWSER_POOL_SIZE=1
MAX_BROWSER_POOL_SIZE=3                 # ä» 5 é™ä¸º 3
MAX_BROWSER_USAGE=15                   # ä» 30 é™ä¸º 15
```

**å¥½å¤„**:
- è¿›ä¸€æ­¥å‡å°‘å†…å­˜å ç”¨
- é™ä½æœåŠ¡å™¨èµ„æºéœ€æ±‚
- æµè§ˆå™¨æ± ä¸ä¼šé—²ç½®

### 2. è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´

```typescript
// LightweightMonitor.ts
const response = await axios.get(url, {
  timeout: 5000,  // æ”¹ä¸º 5 ç§’ï¼ˆé»˜è®¤ 10 ç§’ï¼‰
  // ...
});
```

### 3. æ·»åŠ è‡ªå®šä¹‰å…³é”®å­—æ£€æŸ¥

```typescript
// ä½¿ç”¨æ ‡å‡†ç›‘æ§ + å…³é”®å­—éªŒè¯
{
  url: 'https://www.anker.com',
  name: 'Anker é¦–é¡µ',
  monitoringLevel: 'standard'
}

// åœ¨ PatrolService ä¸­è°ƒç”¨
const result = await standardMonitor.check(url, {
  keywords: ['Anker', 'Products'],  // æ£€æŸ¥å…³é”®å­—
  checkSSL: true,
  checkDNS: true
});
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å®æ–½æ€»ç»“](./LIGHTWEIGHT_MONITORING_IMPLEMENTATION.md)
- [å¯ç”¨æ€§ç›‘æ§æœ€ä½³å®è·µ](./AVAILABILITY_MONITORING_BEST_PRACTICE.md)
- [å·¡æ£€ä¼˜åŒ–æ–¹æ¡ˆ](./PATROL_OPTIMIZATION_FINAL.md)

---

## ğŸ‰ æ€»ç»“

è½»é‡çº§ç›‘æ§ç°åœ¨å·²ç»é›†æˆåˆ°å·¡æ£€ç³»ç»Ÿä¸­ï¼Œ**æ— éœ€ä»»ä½•é…ç½®å³å¯ä½¿ç”¨**ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç½‘ç«™ç±»å‹å¹¶é€‰æ‹©æœ€ä¼˜çš„ç›‘æ§æ–¹å¼ï¼Œå¤§å¹…æå‡æ€§èƒ½å’Œé™ä½æˆæœ¬ã€‚

**å…³é”®ä¼˜åŠ¿**:
- âœ… **é›¶é…ç½®**ï¼šè‡ªåŠ¨å·¥ä½œï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
- âœ… **æ™ºèƒ½åŒ–**ï¼šè‡ªåŠ¨æ£€æµ‹ç½‘ç«™ç±»å‹
- âœ… **åŒé‡ç¡®è®¤**ï¼šè½»é‡çº§å¤±è´¥åè‡ªåŠ¨å‡çº§åˆ°æµè§ˆå™¨
- âœ… **å‘åå…¼å®¹**ï¼šç°æœ‰ä»»åŠ¡æ— éœ€ä¿®æ”¹

**é¢„æœŸæ•ˆæœ**:
- ğŸš€ æ£€æµ‹é€Ÿåº¦æå‡ **10-20 å€**
- ğŸ’° èµ„æºæˆæœ¬é™ä½ **75%**
- ğŸ“Š å¹¶å‘èƒ½åŠ›æå‡ **10 å€**

ç«‹å³éƒ¨ç½²ï¼Œäº«å—æ€§èƒ½æå‡ï¼
