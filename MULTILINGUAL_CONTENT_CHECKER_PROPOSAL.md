# å¤šè¯­è¨€æ–‡æ¡ˆæ£€æŸ¥åŠŸèƒ½ - æŠ€æœ¯æ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**: 2025-12-25
**éœ€æ±‚**: æ£€æŸ¥ç½‘ç«™é¡µé¢çš„å¤šè¯­è¨€æ–‡æ¡ˆé…ç½®(è‹±æ–‡/å¾·è¯­/æ³•è¯­),è¯†åˆ«åŸºç¡€æ–‡æ¡ˆé…ç½®é”™è¯¯

## ğŸ“Š ä¸šå†…å·¥å…·è°ƒç ”æ€»ç»“

### å•†ä¸šå·¥å…·å¯¹æ¯”

| å·¥å…· | è¯­è¨€æ”¯æŒ | æ£€æŸ¥ç±»å‹ | ä¼˜åŠ¿ | æˆæœ¬ |
|------|---------|---------|------|------|
| **Lokalise** | 100+ | è¯­æ³•ã€ä¸€è‡´æ€§ã€æœ¯è¯­ | å®Œæ•´ç”Ÿæ€ã€å®æ—¶åä½œ | $$$$ |
| **Phrase** | 50+ | è´¨é‡æ£€æµ‹ã€æœ¯è¯­ç®¡ç† | ä¸“ä¸šçº§ã€CI/CDé›†æˆ | $$$$ |
| **Crowdin** | 80+ | AIç¿»è¯‘ã€è´¨é‡æ£€æµ‹ | å…¨çƒåŒ–æ”¯æŒ | $$$ |
| **LanguageTool** | 25+ | è¯­æ³•ã€æ‹¼å†™ã€é£æ ¼ | **å¼€æºå…è´¹** | å…è´¹/$ |

### æ¨èå¼€æºæ–¹æ¡ˆ

#### 1. **LanguageTool** (å¼ºçƒˆæ¨è)
- â­ **å¼€æºå…è´¹**
- ğŸŒ æ”¯æŒ 25+ è¯­è¨€(åŒ…æ‹¬è‹±/å¾·/æ³•)
- ğŸ”§ æä¾› REST API å’Œå¤šè¯­è¨€å®¢æˆ·ç«¯
- âœ… å¯ä»¥è‡ªéƒ¨ç½²æˆ–ä½¿ç”¨å®˜æ–¹ API

**GitHub**: https://github.com/languagetool-org/languagetool

#### 2. **Vale** (è¾…åŠ©å·¥å…·)
- â­ å¼€æºçš„æ–‡æ¡ˆé£æ ¼æ£€æŸ¥å·¥å…·
- ğŸ“ è‡ªå®šä¹‰è§„åˆ™å¼•æ“
- ğŸ”„ æ”¯æŒ CI/CD é›†æˆ

**GitHub**: https://github.com/errata-ai/vale

## ğŸ¯ æ£€æŸ¥å†…å®¹åˆ†ç±»

### 1. åŸºç¡€è¯­è¨€é”™è¯¯
- âœ… **æ‹¼å†™é”™è¯¯**: æ£€æµ‹å•è¯æ‹¼å†™
- âœ… **è¯­æ³•é”™è¯¯**: æ—¶æ€ã€è¯­æ€ã€å•å¤æ•°
- âœ… **æ ‡ç‚¹ç¬¦å·**: é”™è¯¯æˆ–ç¼ºå¤±çš„æ ‡ç‚¹

### 2. æœ¬åœ°åŒ–é—®é¢˜
- âœ… **æœ¯è¯­ä¸ä¸€è‡´**: ä¸“ä¸šæœ¯è¯­åœ¨ä¸åŒé¡µé¢çš„ä¸€è‡´æ€§
- âœ… **ç¿»è¯‘ç¼ºå¤±**: é¡µé¢ä¸Šçš„æ–‡æ¡ˆæ˜¯å¦å®Œæ•´ç¿»è¯‘
- âœ… **æ ¼å¼é”™è¯¯**: æ—¥æœŸã€è´§å¸ã€å•ä½æ ¼å¼

### 3. æŠ€æœ¯é—®é¢˜
- âœ… **å ä½ç¬¦é”™è¯¯**: `{name}` ç­‰å˜é‡ç¼ºå¤±æˆ–é”™è¯¯
- âœ… **å­—ç¬¦ç¼–ç **: ç‰¹æ®Šå­—ç¬¦æ˜¾ç¤ºé—®é¢˜
- âœ… **é•¿åº¦é™åˆ¶**: UI æ–‡æ¡ˆé•¿åº¦è¶…é™

### 4. æ–‡åŒ–æ•æ„Ÿæ€§
- âš ï¸ **æ–‡åŒ–ç¦å¿Œ**: ç‰¹å®šè¯­è¨€/åœ°åŒºçš„æ•æ„Ÿè¯æ±‡
- âš ï¸ **è¯­æ°”ä¸€è‡´æ€§**: æ­£å¼/éæ­£å¼è¯­æ°”æ··ç”¨

## ğŸ› ï¸ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: é›†æˆ LanguageTool API (æ¨è)

#### ä¼˜ç‚¹
- âœ… æ— éœ€è‡ªå·±ç»´æŠ¤è¯­æ³•è§„åˆ™
- âœ… æ”¯æŒ 25+ è¯­è¨€å¼€ç®±å³ç”¨
- âœ… ç¤¾åŒºæ´»è·ƒ,æŒç»­æ›´æ–°
- âœ… å¯ä»¥è‡ªéƒ¨ç½²æˆ–ä½¿ç”¨å®˜æ–¹æœåŠ¡

#### å®ç°æ­¥éª¤

**1. å®‰è£… LanguageTool**

```bash
# æ–¹å¼ 1: Docker éƒ¨ç½²(æ¨è)
docker run -d -p 8010:8010 erikvl87/languagetool

# æ–¹å¼ 2: npm åŒ…
npm install languagetool-api
```

**2. API è°ƒç”¨ç¤ºä¾‹**

```typescript
// backend/src/services/LanguageCheckService.ts
import axios from 'axios';

interface LanguageError {
  message: string;
  offset: number;
  length: number;
  context: {
    text: string;
    offset: number;
    length: number;
  };
  rule: {
    id: string;
    category: { id: string; name: string };
  };
  replacements: Array<{ value: string }>;
  type: { typeName: string }; // 'UnknownWord', 'Grammar', etc.
}

export class LanguageCheckService {
  private apiUrl: string;

  constructor() {
    // ä½¿ç”¨è‡ªéƒ¨ç½²çš„ LanguageTool æˆ–å®˜æ–¹ API
    this.apiUrl = process.env.LANGUAGETOOL_API_URL || 'http://localhost:8010/v2/check';
  }

  /**
   * æ£€æŸ¥æ–‡æœ¬çš„è¯­è¨€é”™è¯¯
   */
  async checkText(text: string, language: string): Promise<LanguageError[]> {
    try {
      const response = await axios.post(this.apiUrl, null, {
        params: {
          text: text,
          language: language, // 'en-US', 'de-DE', 'fr-FR'
          enabledOnly: false,
        },
      });

      return response.data.matches || [];
    } catch (error) {
      console.error(`Language check failed for ${language}:`, error);
      throw error;
    }
  }

  /**
   * æ ¼å¼åŒ–æ£€æŸ¥ç»“æœ
   */
  formatErrors(errors: LanguageError[]) {
    return errors.map(error => ({
      severity: this.getSeverity(error.type.typeName),
      message: error.message,
      context: error.context.text,
      position: {
        start: error.offset,
        end: error.offset + error.length,
      },
      suggestions: error.replacements.slice(0, 3).map(r => r.value),
      category: error.rule.category.name,
      ruleId: error.rule.id,
    }));
  }

  private getSeverity(typeName: string): 'error' | 'warning' | 'info' {
    const severityMap: Record<string, 'error' | 'warning' | 'info'> = {
      'UnknownWord': 'error',
      'Grammar': 'error',
      'Style': 'warning',
      'Typographical': 'info',
    };
    return severityMap[typeName] || 'warning';
  }
}
```

**3. é›†æˆåˆ°é¡µé¢æ£€æŸ¥æœåŠ¡**

```typescript
// backend/src/services/MultilingualPatrolService.ts
import { LanguageCheckService } from './LanguageCheckService.js';
import { Page } from 'playwright';

interface MultilingualCheck {
  language: string;
  textContent: string;
  errors: Array<{
    severity: string;
    message: string;
    context: string;
    suggestions: string[];
  }>;
}

export class MultilingualPatrolService {
  private languageCheckService: LanguageCheckService;

  constructor() {
    this.languageCheckService = new LanguageCheckService();
  }

  /**
   * æå–é¡µé¢æ–‡æœ¬å†…å®¹
   */
  async extractPageText(page: Page): Promise<string> {
    // æå–æ‰€æœ‰å¯è§æ–‡æœ¬,æ’é™¤è„šæœ¬å’Œæ ·å¼
    return await page.evaluate(() => {
      const walker = document.createTreeWalker(
        document.body,
        NodeFilter.SHOW_TEXT,
        {
          acceptNode: (node) => {
            // æ’é™¤éšè—å…ƒç´ å’Œè„šæœ¬
            const parent = node.parentElement;
            if (!parent) return NodeFilter.FILTER_REJECT;

            const style = window.getComputedStyle(parent);
            if (style.display === 'none' || style.visibility === 'hidden') {
              return NodeFilter.FILTER_REJECT;
            }

            const tagName = parent.tagName.toLowerCase();
            if (['script', 'style', 'noscript'].includes(tagName)) {
              return NodeFilter.FILTER_REJECT;
            }

            return NodeFilter.FILTER_ACCEPT;
          }
        }
      );

      const texts: string[] = [];
      let node;
      while (node = walker.nextNode()) {
        const text = node.textContent?.trim();
        if (text && text.length > 0) {
          texts.push(text);
        }
      }

      return texts.join('\n');
    });
  }

  /**
   * æ£€æŸ¥å¤šè¯­è¨€é¡µé¢
   */
  async checkMultilingualPage(
    page: Page,
    languages: string[]
  ): Promise<MultilingualCheck[]> {
    const results: MultilingualCheck[] = [];

    for (const language of languages) {
      try {
        // åˆ‡æ¢è¯­è¨€(å‡è®¾é¡µé¢æ”¯æŒè¯­è¨€åˆ‡æ¢)
        await this.switchLanguage(page, language);

        // ç­‰å¾…å†…å®¹åŠ è½½
        await page.waitForTimeout(1000);

        // æå–æ–‡æœ¬
        const textContent = await this.extractPageText(page);

        // æ£€æŸ¥è¯­è¨€é”™è¯¯
        const rawErrors = await this.languageCheckService.checkText(
          textContent,
          this.getLanguageCode(language)
        );

        const errors = this.languageCheckService.formatErrors(rawErrors);

        results.push({
          language,
          textContent,
          errors,
        });

        console.log(`âœ“ Checked ${language}: Found ${errors.length} issues`);
      } catch (error) {
        console.error(`Failed to check ${language}:`, error);
      }
    }

    return results;
  }

  /**
   * åˆ‡æ¢é¡µé¢è¯­è¨€
   */
  private async switchLanguage(page: Page, language: string): Promise<void> {
    // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…ç½‘ç«™çš„è¯­è¨€åˆ‡æ¢æ–¹å¼å®ç°
    // æ–¹å¼ 1: URL å‚æ•°
    const url = new URL(page.url());
    url.searchParams.set('lang', language);
    await page.goto(url.toString());

    // æ–¹å¼ 2: ç‚¹å‡»è¯­è¨€é€‰æ‹©å™¨
    // await page.click(`[data-language="${language}"]`);

    // æ–¹å¼ 3: Cookie
    // await page.context().addCookies([
    //   { name: 'language', value: language, domain: url.hostname, path: '/' }
    // ]);
  }

  /**
   * å°†è¯­è¨€åç§°è½¬æ¢ä¸º LanguageTool ä»£ç 
   */
  private getLanguageCode(language: string): string {
    const languageMap: Record<string, string> = {
      'english': 'en-US',
      'german': 'de-DE',
      'french': 'fr-FR',
      'è‹±æ–‡': 'en-US',
      'å¾·è¯­': 'de-DE',
      'æ³•è¯­': 'fr-FR',
    };
    return languageMap[language.toLowerCase()] || 'en-US';
  }
}
```

### æ–¹æ¡ˆ 2: è‡ªå®šä¹‰è§„åˆ™æ£€æŸ¥(è¡¥å……æ–¹æ¡ˆ)

é€‚ç”¨äºç‰¹å®šçš„ä¸šåŠ¡è§„åˆ™æ£€æŸ¥:

```typescript
// backend/src/services/CustomContentRules.ts
export class CustomContentRules {
  /**
   * æ£€æŸ¥å ä½ç¬¦å®Œæ•´æ€§
   */
  checkPlaceholders(text: string): Array<{ issue: string; position: number }> {
    const issues: Array<{ issue: string; position: number }> = [];

    // æ£€æŸ¥æœªé—­åˆçš„å ä½ç¬¦
    const openBraces = (text.match(/\{/g) || []).length;
    const closeBraces = (text.match(/\}/g) || []).length;

    if (openBraces !== closeBraces) {
      issues.push({
        issue: `ä¸åŒ¹é…çš„å ä½ç¬¦: ${openBraces} ä¸ª '{' å’Œ ${closeBraces} ä¸ª '}'`,
        position: 0,
      });
    }

    return issues;
  }

  /**
   * æ£€æŸ¥æœ¯è¯­ä¸€è‡´æ€§
   */
  checkTerminology(
    text: string,
    language: string,
    glossary: Record<string, string[]>
  ): Array<{ term: string; suggestion: string }> {
    const issues: Array<{ term: string; suggestion: string }> = [];

    // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ ‡å‡†æœ¯è¯­
    for (const [standard, alternatives] of Object.entries(glossary)) {
      for (const alt of alternatives) {
        if (text.includes(alt)) {
          issues.push({
            term: alt,
            suggestion: `å»ºè®®ä½¿ç”¨æ ‡å‡†æœ¯è¯­ "${standard}"`,
          });
        }
      }
    }

    return issues;
  }

  /**
   * æ£€æŸ¥é•¿åº¦é™åˆ¶
   */
  checkLengthLimits(
    segments: Array<{ key: string; text: string; maxLength: number }>
  ): Array<{ key: string; length: number; maxLength: number }> {
    return segments
      .filter(seg => seg.text.length > seg.maxLength)
      .map(seg => ({
        key: seg.key,
        length: seg.text.length,
        maxLength: seg.maxLength,
      }));
  }
}
```

## ğŸ“‹ API è®¾è®¡

### åˆ›å»ºå¤šè¯­è¨€æ£€æŸ¥ä»»åŠ¡

```typescript
POST /api/v1/multilingual/check

Request:
{
  "url": "https://example.com/product",
  "languages": ["english", "german", "french"],
  "checkTypes": ["grammar", "spelling", "terminology", "placeholders"],
  "notificationEmail": "user@example.com"
}

Response:
{
  "taskId": "ml-check-12345",
  "status": "pending",
  "estimatedTime": 45000
}
```

### è·å–æ£€æŸ¥ç»“æœ

```typescript
GET /api/v1/multilingual/check/:taskId

Response:
{
  "taskId": "ml-check-12345",
  "url": "https://example.com/product",
  "status": "completed",
  "results": [
    {
      "language": "english",
      "totalErrors": 5,
      "errors": [
        {
          "severity": "error",
          "message": "Possible spelling mistake found",
          "context": "This is an exmaple text",
          "position": { "start": 11, "end": 17 },
          "suggestions": ["example"],
          "category": "Spelling",
          "ruleId": "MORFOLOGIK_RULE_EN_US"
        }
      ]
    },
    {
      "language": "german",
      "totalErrors": 3,
      "errors": [...]
    }
  ],
  "summary": {
    "totalLanguages": 3,
    "totalErrors": 12,
    "criticalErrors": 5,
    "warnings": 7
  }
}
```

## ğŸ¨ å‰ç«¯å±•ç¤º

### æ£€æŸ¥ç»“æœé¡µé¢è®¾è®¡

```typescript
interface MultilingualCheckResult {
  language: string;
  totalErrors: number;
  errors: LanguageError[];
}

// æŒ‰è¯­è¨€åˆ†ç»„æ˜¾ç¤º
<div className="multilingual-results">
  {results.map(result => (
    <div key={result.language} className="language-section">
      <h3>{result.language}</h3>
      <div className="error-count">
        {result.totalErrors} ä¸ªé—®é¢˜
      </div>

      <div className="error-list">
        {result.errors.map((error, idx) => (
          <div key={idx} className={`error-item ${error.severity}`}>
            <div className="error-message">{error.message}</div>
            <div className="error-context">{error.context}</div>
            {error.suggestions.length > 0 && (
              <div className="suggestions">
                å»ºè®®: {error.suggestions.join(', ')}
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  ))}
</div>
```

## ğŸ’° æˆæœ¬ä¼°ç®—

### è‡ªéƒ¨ç½²æ–¹æ¡ˆ(æ¨è)
- **LanguageTool Docker**: å…è´¹
- **æœåŠ¡å™¨èµ„æº**: ~$20-50/æœˆ (è§†æ£€æŸ¥é‡è€Œå®š)
- **æ€»æˆæœ¬**: $20-50/æœˆ

### ä½¿ç”¨å®˜æ–¹ API
- **LanguageTool Premium API**:
  - å…è´¹: 20 æ¬¡/å¤©
  - ä»˜è´¹: $59/æœˆ èµ·(æ— é™åˆ¶)

## ğŸš€ å®æ–½è·¯çº¿å›¾

### Phase 1: MVP (2-3 å‘¨)
- âœ… é›†æˆ LanguageTool API
- âœ… åŸºç¡€è¯­æ³•å’Œæ‹¼å†™æ£€æŸ¥
- âœ… æ”¯æŒè‹±è¯­/å¾·è¯­/æ³•è¯­
- âœ… ç®€å•çš„ç»“æœå±•ç¤º

### Phase 2: å¢å¼ºåŠŸèƒ½ (2-3 å‘¨)
- âœ… è‡ªå®šä¹‰è§„åˆ™å¼•æ“
- âœ… æœ¯è¯­ä¸€è‡´æ€§æ£€æŸ¥
- âœ… å ä½ç¬¦éªŒè¯
- âœ… é•¿åº¦é™åˆ¶æ£€æŸ¥

### Phase 3: ä¼˜åŒ–å’Œé›†æˆ (1-2 å‘¨)
- âœ… æ‰¹é‡æ£€æŸ¥æ”¯æŒ
- âœ… å®šæ—¶å·¡æ£€é›†æˆ
- âœ… é‚®ä»¶æŠ¥å‘Šä¼˜åŒ–
- âœ… æ€§èƒ½ä¼˜åŒ–

## ğŸ“Š é¢„æœŸæ•ˆæœ

### å¯æ£€æµ‹çš„é—®é¢˜ç±»å‹
1. âœ… **æ‹¼å†™é”™è¯¯**: 95%+ å‡†ç¡®ç‡
2. âœ… **åŸºç¡€è¯­æ³•**: 90%+ å‡†ç¡®ç‡
3. âœ… **æœ¯è¯­ä¸ä¸€è‡´**: 100% (è‡ªå®šä¹‰è§„åˆ™)
4. âœ… **æ ¼å¼é—®é¢˜**: 100% (è‡ªå®šä¹‰è§„åˆ™)

### æ€§èƒ½æŒ‡æ ‡
- å•é¡µæ£€æŸ¥æ—¶é—´: ~5-10 ç§’
- æ”¯æŒå¹¶å‘æ£€æŸ¥: 3-5 ä¸ªè¯­è¨€
- å†…å­˜å ç”¨: ~500MB (LanguageTool)

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **éªŒè¯å¯è¡Œæ€§**: éƒ¨ç½² LanguageTool Docker æµ‹è¯•
2. **API é›†æˆ**: å®ç°åŸºç¡€çš„è¯­è¨€æ£€æŸ¥æœåŠ¡
3. **å‰ç«¯å¼€å‘**: åˆ›å»ºå¤šè¯­è¨€æ£€æŸ¥å…¥å£
4. **æµ‹è¯•éªŒè¯**: ä½¿ç”¨çœŸå®é¡µé¢æµ‹è¯•æ•ˆæœ
5. **è¿­ä»£ä¼˜åŒ–**: æ ¹æ®åé¦ˆè°ƒæ•´è§„åˆ™

## ğŸ“š å‚è€ƒèµ„æº

- LanguageTool å®˜æ–¹æ–‡æ¡£: https://languagetool.org/http-api/
- LanguageTool Docker: https://github.com/erikvl87/docker-languagetool
- Vale æ–‡æ¡£: https://vale.sh/docs/
- i18n æœ€ä½³å®è·µ: https://www.w3.org/International/

---

**å»ºè®®**: å…ˆä½¿ç”¨ LanguageTool æ„å»º MVP,éªŒè¯æ•ˆæœåå†è€ƒè™‘æ›´å¤æ‚çš„è‡ªå®šä¹‰è§„åˆ™ã€‚
