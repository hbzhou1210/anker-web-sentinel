# 🚀 Anker Web Sentinel 快速使用指南

## 📍 访问地址

### 前端应用
```
http://localhost:5173
```

### 后端 API
```
http://localhost:3000
健康检查: http://localhost:3000/health
API 文档: http://localhost:3000/api/v1
```

---

## 🎯 核心功能

### 1️⃣ 日常巡检管理（新增定时调度显示）

**功能：** 自动化监控网站可用性，定时执行并发送邮件通知

**如何使用：**
1. 访问前端首页，点击"日常巡检管理"
2. 查看现有任务，每个任务卡片现在显示：
   - ✅ 任务名称和状态
   - ✅ 检测 URL 数量
   - ✅ 通知邮箱
   - ✅ **定时调度信息**（新增！）
3. 点击"创建任务"添加新的巡检任务
4. 点击"执行"按钮手动触发巡检

**定时调度显示：**
```
🕐 定时调度: 每天 15:40
🕐 定时调度: 每天 09:00, 14:00
🕐 定时调度: 未设置定时
```

---

### 2️⃣ 响应式测试（已验证正常）

**功能：** 测试网站在不同设备上的响应式表现

**如何使用：**
1. 点击"响应式测试"
2. 输入要测试的 URL
3. 选择测试设备（支持 iPhone、iPad、Android、Desktop）
4. 点击"开始测试"
5. 等待 15-20 秒查看结果

**测试内容：**
- ✅ 横向滚动检测
- ✅ Viewport Meta 标签检查
- ✅ 字体大小可读性
- ✅ 触摸目标尺寸
- ✅ 图片响应式
- ✅ 截图预览（竖屏/横屏）

---

### 3️⃣ 性能测试

**支持两种测试方式：**

#### A. WebPageTest（真实设备测试）
- 使用真实移动设备
- 提供详细的性能指标
- 支持多地域测试

#### B. PageSpeed Insights（Google Lighthouse）
- 快速性能评分
- Core Web Vitals 指标
- 优化建议

**如何使用：**
1. 点击对应的性能测试选项
2. 输入 URL
3. 选择测试配置（设备、地域等）
4. 提交测试
5. 等待结果返回（WebPageTest 较慢，约 2-5 分钟）

---

## 🔧 系统配置

### 当前运行状态
```
✅ 环境：开发模式
✅ 数据存储：飞书 Bitable
✅ 浏览器池：3 个健康实例
✅ 并发测试：最多 3 个 URL
✅ Redis：已禁用（开发环境）
✅ 邮件服务：已配置
```

### 定时任务
系统当前运行 3 个定时巡检任务：
- 任务 1：每天 15:40（Asia/Shanghai 时区）
- 任务 2：每天 15:45（Asia/Shanghai 时区）
- 任务 3：每天 15:50（Asia/Shanghai 时区）

---

## 📊 功能特点

### 巡检功能亮点
- ✅ 支持多 URL 批量检测
- ✅ 智能重试机制
- ✅ 浏览器池自动管理
- ✅ 邮件通知（失败时自动发送）
- ✅ 视觉对比（可选）
- ✅ 多设备测试支持
- ✅ 定时调度可视化

### 响应式测试亮点
- ✅ 12 种预设设备（iPhone、iPad、Android、Desktop）
- ✅ 并发测试多个设备
- ✅ 自动截图（竖屏+横屏）
- ✅ 详细的问题报告
- ✅ 智能重试（防止浏览器崩溃）
- ✅ 结果缓存（localStorage）

### 性能测试亮点
- ✅ 双引擎支持（WebPageTest + PageSpeed）
- ✅ Core Web Vitals 分析
- ✅ AI 智能建议（Claude AI）
- ✅ 历史记录查询
- ✅ 多维度对比

---

## 🐛 故障排查

### 如果服务未启动
```bash
cd /Users/anker/anita-project
npm run dev
```

### 如果前端无法访问
```bash
# 检查前端服务
curl http://localhost:5173

# 如果失败，单独启动前端
npm run dev:frontend
```

### 如果后端无法访问
```bash
# 检查后端服务
curl http://localhost:3000/health

# 如果失败，单独启动后端
npm run dev:backend
```

### 如果浏览器测试失败
- 检查浏览器池状态（后端日志）
- 查看 `/tmp/screenshots/` 目录权限
- 重启服务清空浏览器池

---

## 📝 常用命令

### 启动服务
```bash
# 同时启动前后端
npm run dev

# 单独启动后端
npm run dev:backend

# 单独启动前端
npm run dev:frontend
```

### 构建生产版本
```bash
npm run build
```

### 运行测试
```bash
npm run test
```

### 清理缓存
```bash
npm run clean
```

---

## 🔗 相关文档

### 项目文档
- `README.md` - 项目概述
- `PHASE_2_4_SUMMARY.md` - 阶段总结
- `问题修复总结_2025-12-18.md` - 最新修复记录

### API 文档
- 巡检接口：`/api/v1/patrol/*`
- 调度接口：`/api/v1/patrol/schedules`
- 响应式测试：`/api/v1/responsive/*`
- 性能测试：`/api/v1/tests/*`

### 配置文件
- `.env` - 环境变量配置
- `.env.example` - 配置模板
- `docker-compose.yml` - Docker 部署配置

---

## 💡 使用技巧

### 1. 快速测试单个 URL
- 使用"响应式测试"比巡检更快
- 直接看到截图和问题报告

### 2. 定时巡检最佳实践
- 选择业务低峰期执行
- 配置合适的通知邮箱
- 启用视觉对比可以发现布局变化

### 3. 性能测试建议
- WebPageTest 适合真实设备测试
- PageSpeed Insights 适合快速评估
- 两者结合使用效果最佳

### 4. 查看定时任务
- 在"日常巡检管理"页面查看所有任务的调度时间
- 橙色卡片显示"定时调度"信息
- 显示格式：每天 HH:mm

---

## 📞 支持

遇到问题？
1. 查看浏览器控制台错误
2. 查看后端日志输出
3. 检查 `/tmp/screenshots/` 目录
4. 参考 `问题修复总结_2025-12-18.md`

---

## 🎉 最新更新

### 2025-12-18

✅ **新增功能：** 巡检任务定时调度可视化
- 任务卡片现在显示调度时间
- 支持友好的时间格式
- 自动加载所有任务的调度配置

✅ **验证完成：** 响应式测试功能正常
- 后端接口完全正常
- 测试速度快（15 秒内完成）
- 截图功能正常

✅ **重要修复：** 浏览器崩溃问题已解决
- 内存限制提升：512MB → 2GB
- 进程模式优化：单进程 → 多进程
- 生命周期缩短：60分钟 → 30分钟
- 使用次数限制：100次 → 30次
- 详细修复说明：见 `浏览器崩溃问题修复总结_2025-12-18.md`

---

**🚀 现在就开始使用吧！访问 http://localhost:5173**
