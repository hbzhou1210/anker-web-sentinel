# éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ å‰ç«¯æ›´æ–°éƒ¨ç½²æµç¨‹

æ¯æ¬¡å‰ç«¯ä»£ç ä¿®æ”¹å,éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ‰èƒ½ä½¿æ›´æ”¹åœ¨ç”Ÿäº§ç¯å¢ƒç”Ÿæ•ˆ:

### 1. æœ¬åœ°æ„å»ºæµ‹è¯•
```bash
# 1. ç¡®ä¿æœ¬åœ°ä»£ç æ˜¯æœ€æ–°çš„
git fetch coding master
git status

# 2. æ„å»ºå‰ç«¯
npm run build:frontend

# 3. æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la dist/frontend/
```

### 2. æäº¤ä»£ç 
```bash
# 1. æŸ¥çœ‹ä¿®æ”¹
git status
git diff

# 2. æ·»åŠ ä¿®æ”¹
git add .

# 3. æäº¤
git commit -m "æè¿°ä½ çš„ä¿®æ”¹"

# 4. æ¨é€åˆ°è¿œç¨‹
git push coding master
git push github master
```

### 3. æœåŠ¡å™¨éƒ¨ç½²

SSHç™»å½•åˆ°ç”Ÿäº§æœåŠ¡å™¨å:

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/anker-web-sentinel

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 3. å®‰è£…ä¾èµ–(å¦‚æœpackage.jsonæœ‰å˜åŒ–)
npm install

# 4. é‡æ–°æ„å»ºå‰ç«¯
npm run build:frontend

# 5. é‡å¯æœåŠ¡(æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©)
# å¦‚æœä½¿ç”¨PM2:
pm2 restart anker-web-sentinel

# å¦‚æœä½¿ç”¨Docker:
docker-compose restart

# å¦‚æœä½¿ç”¨systemd:
sudo systemctl restart anker-web-sentinel
```

### 4. éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
# æˆ–
docker-compose ps
# æˆ–
sudo systemctl status anker-web-sentinel

# 2. æ£€æŸ¥åç«¯å¥åº·
curl http://localhost:3000/health

# 3. åœ¨æµè§ˆå™¨ä¸­è®¿é—®åº”ç”¨
# http://10.5.3.150:10038
```

### 5. æ¸…ç†æµè§ˆå™¨ç¼“å­˜

**é‡è¦**: ç”±äºnginxé…ç½®äº†å¼ºç¼“å­˜,ç”¨æˆ·éœ€è¦æ¸…ç†ç¼“å­˜æ‰èƒ½çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬:

- **Chrome/Edge**: `Ctrl+Shift+Delete` æˆ– `Cmd+Shift+Delete`
- **å¼ºåˆ¶åˆ·æ–°**: `Ctrl+F5` æˆ– `Cmd+Shift+R`
- **å¼€å‘è€…æ¨¡å¼**: F12 -> Network -> Disable cache

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: å‰ç«¯ä¿®æ”¹ä¸ç”Ÿæ•ˆ?

**åŸå› **:
1. æ²¡æœ‰é‡æ–°æ„å»ºå‰ç«¯(`npm run build:frontend`)
2. æµè§ˆå™¨å¼ºç¼“å­˜(nginxé…ç½®çš„1å¹´ç¼“å­˜)
3. æœåŠ¡å™¨ä¸Šçš„distæ–‡ä»¶å¤¹æ²¡æœ‰æ›´æ–°

**è§£å†³**:
1. ç¡®ä¿åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†`npm run build:frontend`
2. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨(`Ctrl+F5`)
3. æ£€æŸ¥dist/frontendç›®å½•çš„ä¿®æ”¹æ—¶é—´

### Q2: nginxé…ç½®ä¿®æ”¹åä¸ç”Ÿæ•ˆ?

**åŸå› **: nginxé…ç½®ä¿®æ”¹åéœ€è¦é‡å¯

**è§£å†³**:
```bash
# æµ‹è¯•nginxé…ç½®
sudo nginx -t

# é‡å¯nginx
sudo systemctl reload nginx
# æˆ–
sudo nginx -s reload
```

### Q3: åç«¯ä»£ç ä¿®æ”¹åä¸ç”Ÿæ•ˆ?

**è§£å†³**:
```bash
# 1. é‡æ–°æ„å»ºåç«¯
npm run build:backend

# 2. é‡å¯åç«¯æœåŠ¡
pm2 restart anker-web-sentinel-backend
```

## ğŸ”§ nginxä»£ç†é…ç½®è¯´æ˜

ä»¥ä¸‹è·¯å¾„éœ€è¦ä»£ç†åˆ°åç«¯(localhost:3000):

- `/api/*` - APIæ¥å£
- `/screenshots/*` - æˆªå›¾æ–‡ä»¶
- `/discount-rule-tool/*` - ä¹°èµ è§„åˆ™æŸ¥è¯¢å·¥å…·
- `/discount-rule-output/*` - ä¹°èµ è§„åˆ™æŸ¥è¯¢æŠ¥å‘Š

å…¶ä»–è·¯å¾„ç”±nginxç›´æ¥æä¾›å‰ç«¯é™æ€æ–‡ä»¶ã€‚

## ğŸ“ ç‰ˆæœ¬ç®¡ç†å»ºè®®

### 1. ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
åœ¨package.jsonä¸­ç»´æŠ¤ç‰ˆæœ¬å·:
```json
{
  "version": "1.2.3"
}
```

### 2. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
```bash
git tag -a v1.2.3 -m "ç‰ˆæœ¬1.2.3: ä¿®å¤ä¹°èµ å·¥å…·åµŒå¥—é—®é¢˜"
git push coding v1.2.3
git push github v1.2.3
```

### 3. ç»´æŠ¤CHANGELOG
è®°å½•æ¯ä¸ªç‰ˆæœ¬çš„é‡è¦å˜æ›´ã€‚

## ğŸš€ å¿«é€Ÿéƒ¨ç½²è„šæœ¬

å¯ä»¥åˆ›å»ºä¸€ä¸ªéƒ¨ç½²è„šæœ¬ç®€åŒ–æµç¨‹:

```bash
#!/bin/bash
# deploy.sh

echo "ğŸš€ å¼€å§‹éƒ¨ç½²..."

# 1. æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull || exit 1

# 2. å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install

# 3. æ„å»ºå‰ç«¯
echo "ğŸ”¨ æ„å»ºå‰ç«¯..."
npm run build:frontend || exit 1

# 4. æ„å»ºåç«¯
echo "ğŸ”¨ æ„å»ºåç«¯..."
npm run build:backend || exit 1

# 5. é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
pm2 restart anker-web-sentinel

# 6. æ£€æŸ¥çŠ¶æ€
echo "âœ… æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
pm2 status
curl -s http://localhost:3000/health

echo "âœ¨ éƒ¨ç½²å®Œæˆ!"
echo "âš ï¸  æé†’ç”¨æˆ·æ¸…ç†æµè§ˆå™¨ç¼“å­˜(Ctrl+F5)ä»¥æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬"
```

ä½¿ç”¨æ–¹æ³•:
```bash
chmod +x deploy.sh
./deploy.sh
```

## ğŸ“Š éƒ¨ç½²æ—¶é—´é¢„ä¼°

- ä»£ç æ‹‰å–: ~10ç§’
- ä¾èµ–å®‰è£…: ~30ç§’(å¦‚æ— å˜åŒ–åˆ™è·³è¿‡)
- å‰ç«¯æ„å»º: ~30-60ç§’
- åç«¯æ„å»º: ~20-30ç§’
- æœåŠ¡é‡å¯: ~5-10ç§’

**æ€»è®¡**: çº¦2-3åˆ†é’Ÿ

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

1. âœ… å§‹ç»ˆåœ¨æœ¬åœ°æµ‹è¯•é€šè¿‡åå†éƒ¨ç½²
2. âœ… éƒ¨ç½²å‰å¤‡ä»½å½“å‰ç‰ˆæœ¬
3. âœ… åœ¨ä½å³°æ—¶æ®µéƒ¨ç½²
4. âœ… éƒ¨ç½²åç«‹å³éªŒè¯æ ¸å¿ƒåŠŸèƒ½
5. âœ… å‡†å¤‡å¥½å›æ»šæ–¹æ¡ˆ
