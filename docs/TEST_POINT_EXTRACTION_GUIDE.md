# 测试点提取功能使用指南

## 功能概述

从飞书需求文档自动提取测试点,生成测试用例表格,并保存到数据库。

## 使用方式

### 方式 1: 通过 Claude Code 辅助(推荐)

**适用场景**: 没有飞书 API 凭据,但在 Claude Code 环境中工作

**操作步骤**:

1. **在应用中输入飞书文档链接**
   - 访问 http://localhost:5173
   - 进入"测试点提取"页面
   - 输入飞书文档 URL (例如: `https://example.feishu.cn/docx/A0HVd6B7CoJIuXx1Cjxcjm32nKg`)

2. **获取文档内容**
   - 在 Claude Code 对话中说: "请帮我获取这个飞书文档的内容: [粘贴链接]"
   - Claude 会调用 MCP 工具 `mcp__feishu__docx_v1_document_rawContent` 获取内容
   - 将返回的文档内容复制

3. **完成提取**
   - 将文档内容粘贴到应用的"文档内容"输入框
   - 点击"提取测试点并保存到飞书"
   - 系统自动提取测试点并生成测试用例表格

**示例对话**:
```
用户: 请帮我获取这个飞书文档的内容: https://example.feishu.cn/docx/A0HVd6B7CoJIuXx1Cjxcjm32nKg

Claude: [调用 MCP 工具获取内容]
文档内容:
阳台SKU后缀去除需求
背景：目前阳台产品通过后缀区分...
[完整内容]

用户: [复制内容粘贴到应用]
```

### 方式 2: 配置飞书 API(完全自动化)

**适用场景**: 有飞书应用管理权限,希望完全自动化

**配置步骤**:

1. 访问 https://open.feishu.cn/app 创建应用
2. 获取 App ID 和 App Secret
3. 编辑 `backend/.env`:
   ```bash
   FEISHU_APP_ID=cli_xxxxx
   FEISHU_APP_SECRET=xxxxx
   ```
4. 重启后端服务

**使用**:
- 只需输入飞书文档链接
- 留空文档内容
- 点击提取,系统自动完成

### 方式 3: 手动复制粘贴(始终可用)

**操作步骤**:

1. 打开飞书文档,复制全部内容
2. 在应用中输入文档链接(可选)
3. 粘贴内容到"文档内容"框
4. 点击"提取测试点并保存到飞书"

## 输出结果

### 1. 卡片视图
- 显示每个测试点的详细信息
- 优先级标识(高/中/低)
- 测试类型、前置条件、预期结果

### 2. 表格预览
生成 8 列 Markdown 格式的测试用例表格:
- 用例ID (TC0001, TC0002...)
- 模块
- 优先级
- 测试类型
- 用例标题
- 操作步骤
- 预期结果
- 实际执行结果

### 3. 数据库存储
- 自动保存到 `test_points` 表
- 关联飞书文档信息
- 支持后续查询和管理

## 示例

### 输入
飞书文档链接: `https://example.feishu.cn/docx/xxxxx`

文档内容:
```
阳台SKU后缀去除需求

背景：目前阳台产品通过后缀区分同一产品的不同定价类型...

需求：
1. 欧洲站点DE、FR、EU、NL、IT、UK后缀清单
2. 以-分割，当SKU第二部分全为数字时...
```

### 输出
```markdown
# 测试用例管理表

| 用例ID | 模块 | 优先级 | 测试类型 | 用例标题 | 操作步骤 | 预期结果 | 实际执行结果 |
|--------|------|--------|----------|----------|----------|----------|-------------|
| TC0001 | SKU管理 | 高 🔴 | 功能测试 | 欧洲站点后缀清除 | 1.输入A17C13Z1-85-DE-HES<br>2.执行后缀清除 | 返回A17C13Z1-85 | 待测试 |
| TC0002 | SKU管理 | 中 🟡 | 边界测试 | 数字后缀识别 | 测试各种SKU格式 | 正确识别数字部分 | 待测试 |
...
```

## 快速开始命令

```bash
# 在 Claude Code 中使用快捷命令
"请帮我从飞书文档提取测试点: [文档链接]"

# Claude 会自动:
# 1. 调用 MCP 工具获取文档内容
# 2. 提示你将内容粘贴到应用
# 3. 或者直接返回提取的测试点供你查看
```

## 故障排查

### 问题: "飞书API未配置"
**解决**: 使用方式1(Claude Code辅助)或方式3(手动粘贴)

### 问题: "无法提取文档ID"
**解决**: 检查URL格式是否正确,应为 `https://xxx.feishu.cn/docx/xxxxx`

### 问题: "未能从文档中提取到测试点"
**解决**:
- 检查文档内容是否包含需求描述
- 尝试提供更详细的需求信息
- 确保文档内容格式清晰

## 技术架构

```
前端输入
    ↓
POST /api/v1/test-points/extract-and-save
    ↓
验证URL → 提取文档ID
    ↓
[方式1] 返回ID → Claude Code获取内容
[方式2] 调用飞书API自动获取
[方式3] 使用用户粘贴的内容
    ↓
AI提取测试点 (Claude Sonnet 4.5)
    ↓
生成Markdown表格
    ↓
保存到数据库
    ↓
返回结果
```

## 相关文档

- [API 文档](../specs/001-web-automation-checker/contracts/api.yaml)
- [数据模型](../specs/001-web-automation-checker/data-model.md)
- [功能规范](../specs/001-web-automation-checker/spec.md)
